<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Python-cod</title>
    <link rel="stylesheet" href="bootstrap.min.css">
    <link rel="stylesheet" href="main.css">
</head>
<body>
  <ul class="nav nav-tabs bg-success shadow rounded sticky-sm-top ">
    <li class="nav-item">
      <a class="nav-link text-white" aria-current="page" href="../python/index.html">Главная</a>
    </li>
    <li class="nav-item">
      <a class="nav-link active link-dark fw-bolder" href="../data/index.html">Подключение и обработка</a>
    </li>
    <li class="nav-item">
        <a class="nav-link text-white" href="../text/index.html">Работа с данными</a>
      </li> 
    <li class="nav-item">
      <a class="nav-link text-white" href="../table/index.html">Визуализация</a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-white" href="../photo/index.html">Модель</a>
    </li>
  </ul>

  
  <div class="container gx-4 py-3">
    <p class="text-start fs-2 fw-bold text-success">Часть 1.1 Подготовка обучающей  и тестовой выборок</p>
    
    <p class="text-start fw-bolder">Импорт библиотек</p>
      <p>import pandas as pd</p>
      <p>import matplotlib.pyplot as plt</p>
      <p>import numpy as np</p>
      <p>import time</p>
      <p>from colorama import Fore, Back, Style</p>
      <p>from sklearn import datasets, linear_model</p>
      <p>.</p>
      <p class="text-start fw-bolder">Создаем необходимые списки</p>
      
      <p>from sklearn.linear_model import LinearRegression</p>
      <p>timelists = list()</p>
      <p>newmatrix1lists = list()</p>
      <p>newmatrix2lists = list()</p>
      <p>sestimelist = list()</p>
      <p>.</p>
      <p class="text-start fw-bolder">Загрузка баз данных</p>

      <p>rd_test = pd.read_csv("test_ses.csv", delimiter=",")</p>
      <p>df_test = pd.DataFrame(rd_test)</p>
      <p>rd_train = pd.read_csv("train_ses.csv", delimiter=",")</p>
      <p>df_train = pd.DataFrame(rd_train)</p>
      <p>.</p>
      <p>def dropnulls():</p>
        <p class="text-start fw-bolder px-4">Удаление пустых значений</p>
        <p class="px-4">df_test.fillna(0)</p>
        <p class="px-4">df_train.fillna(0)</p>
        <p class="px-4">print("Произвел удаление пустых значений.")</p>
        <p>.</p>
      <p>def sortdb():</p>
        <p class="px-4 fw-bolder">Сортировка по файлу</p>
        <p class="px-4">df_test.describe()</p>  
        <p class="px-4">df_train.describe()</p>  
        <p class="px-4">print("Произвел сортировку по файлу.")</p>  
        <p>.</p>
      <p>def sortsess():</p> 
        <p class="px-4 fw-bolder">Сортируем Таблицы по номеру ссесий</p>
        <p class="px-4">df_test.sort_values('session_id')</p>
        <p class="px-4">df_train.sort_values('session_id')</p>
        <p class="px-4">print("Произвел сортировку таблиц по номеру сессий.")</p>
        <p>.</p>    
   <p class="text-start fs-2 fw-bold text-success">Часть 1.2 Работа с разреженным форматом данных</p>      
      <p class="text-start fw-bolder">Создадим метод с матрицей для отражения "мешка сайтов", для базы test_ses</p>     
        <p>def visitsits_dftest():</p>   
          <p class="px-4">for inds in range(10):</p>
            <p class="px-5">sits_index = df_test['site1'][inds]</p>
            <p class="px-5">sites_session = df_test['session_id'][inds]</p>
            <p class="px-5">new_matix = np.matrix(sits_index, sites_session)</p>
            <p class="px-5">newmatrix1lists.append(new_matix)</p>
          <p class="px-4">return newmatrix1lists</p>
          <p>.</p>    
      <p class="text-start fw-bolder">Создадим метод с матрицей для отражения "мешка сайтов", для базы train_ses</p>        
        <p>def visitsits_dftrain():</p>   
          <p class="px-4">for inds in range(10):</p>
            <p class="px-5">df_train['session_id'][inds]</p>
            <p class="px-5">sits_index = df_test['site1'][inds]</p>
            <p class="px-5">sites_session = df_test['session_id'][inds]</p>
            <p class="px-5">new_matix = np.matrix(sits_index, sites_session)</p>
            <p class="px-5">newmatrix2lists.append(new_matix)</p>
          <p class="px-4">return newmatrix2lists</p>
                    
          <p>.</p>  
      <p class="text-start fw-bolder">Создадим метод с матрицей для отражения "мешка сайтов", раномные значения</p>        
        <p>def visitsits_dftrain_rand():</p>   
          <p class="px-4">for inde in range(10):</p>
              <p class="px-5">df_ands = pd.DataFrame(np.matrix(np.random.rand(1, 1)), columns=[df_train['site1'][inde]], index=[df_train['session_id'][inde]])</p>
              <p class="px-5">print(df_ands)</p>
              <p>.</p>
      <p class="text-start fw-bolder">Данный метод отражает Сайт, Сесию, и имеется ли дублкат сессий на данном сайте. (Session: Сессия Sits1Index: Индекс сайта Duplicate: True/False)</p> 
        <p>def sutes_session_dub():</p>   
          <p class="px-4">sites_session = 'session_id'</p>
          <p class="px-4">for inds in range(10):</p>
            <p class="px-5">ses = df_train['session_id'][inds]</p> 
            <p class="px-5">sits1_index = df_test['site1'][inds]</p>
            <p class="px-5">sits2_index = df_test['site2'][inds]</p>
            <p class="px-5">sits3_index = df_test['site3'][inds]</p>
            <p class="px-5">sits4_index = df_test['site4'][inds]</p>
            <p class="px-5">sits5_index = df_test['site5'][inds]</p>
            <p class="px-5">sits6_index = df_test['site6'][inds]</p>
            <p class="px-5">sits7_index = df_test['site7'][inds]</p>
            <p class="px-5">sits8_index = df_test['site8'][inds]</p>
            <p class="px-5">sits9_index = df_test['site9'][inds]</p>
            <p class="px-5">sits10_index = df_test['site10'][inds]</p>
            <p class="px-5">sitedub1 = df_test.duplicated(subset=[sites_session, 'site1']).any()</p>
            <p class="px-5">sitedub2 = df_test.duplicated(subset=[sites_session, 'site2']).any()</p>
            <p class="px-5">sitedub3 = df_test.duplicated(subset=[sites_session, 'site3']).any()</p>
            <p class="px-5">sitedub4 = df_test.duplicated(subset=[sites_session, 'site4']).any()</p>
            <p class="px-5">sitedub5 = df_test.duplicated(subset=[sites_session, 'site5']).any()</p>
            <p class="px-5">sitedub6 = df_test.duplicated(subset=[sites_session, 'site6']).any()</p>
            <p class="px-5">sitedub7 = df_test.duplicated(subset=[sites_session, 'site7']).any()</p>
            <p class="px-5">sitedub8 = df_test.duplicated(subset=[sites_session, 'site8']).any()</p>
            <p class="px-5">sitedub9 = df_test.duplicated(subset=[sites_session, 'site9']).any()</p>
            <p class="px-5">sitedub10 = df_test.duplicated(subset=[sites_session, 'site10']).any()</p>
            <p class="px-5">print(Fore.YELLOW + "Session: {}".format(ses)</p>
            <p class="px-5">+" \nSits1Index: {}".format(sits1_index)+ " Duplicate: {}".format(sitedub1)</p>
            <p>.</p>
                   
            <p class="px-5"> +" \nSits2Index: {}".format(sits2_index)+ " Duplicate: {}".format(sitedub2)</p>
            <p class="px-5"> +" \nSits3Index: {}".format(sits3_index)+ " Duplicate: {}".format(sitedub3)</p>
            <p class="px-5">+" \nSits4Index: {}".format(sits4_index)+ " Duplicate: {}".format(sitedub4)</p>
            <p class="px-5">+" \nSits5Index: {}".format(sits5_index)+ " Duplicate: {}".format(sitedub5)</p>
            <p class="px-5">+" \nSits6Index: {}".format(sits6_index)+ " Duplicate: {}".format(sitedub6)</p>
            <p class="px-5">+" \nSits7Index: {}".format(sits7_index)+ " Duplicate: {}".format(sitedub7)</p>
            <p class="px-5">+" \nSits8Index: {}".format(sits8_index)+ " Duplicate: {}".format(sitedub8)</p>
            <p class="px-5">+" \nSits9Index: {}".format(sits9_index)+ " Duplicate: {}".format(sitedub9)</p>
            <p class="px-5">+" \nSits10Index: {}".format(sits10_index)+ " Duplicate: {}".format(sitedub10)</p>
            <p class="px-5">)</p>
            <p>.</p>
    <p class="text-start fs-2 fw-bold text-success">1.3 Визуальный анализ данных</p>
      <p class="text-start fw-bolder ">Отрисуем график посещений сайтов, чтобы понять куда чаще заходил пользователь. (База : test_ses.csv)</p> 
      <p>def sist_check_df_test():</p>  
        <p class="px-4">plt.plot(df_test['site1'], color="b")</p>
        <p class="px-4">plt.plot(df_test['site2'], color="g")</p>
        <p class="px-4">plt.plot(df_test['site3'], color="r")</p>
        <p class="px-4">plt.plot(df_test['site4'], color="c")</p>
        <p class="px-4">plt.plot(df_test['site5'], color="m")</p>
        <p class="px-4">plt.plot(df_test['site6'], color="y")</p>
        <p class="px-4">plt.plot(df_test['site7'], color="silver")</p>
        <p class="px-4">plt.plot(df_test['site8'], color="wheat")</p>
        <p class="px-4">plt.plot(df_test['site9'], color="lime")</p>
        <p class="px-4">plt.plot(df_test['site10'], color="violet")</p>
        <p class="px-4">plt.show()</p>
        <p>.</p>
      <p class="text-start fw-bolder ">Отрисуем график посещений сайтов, чтобы понять куда чаще заходил пользователь. (База : train_ses.csv)</p> 
        <p>def sist_check_df_train():</p>
        <p class="px-4">plt.plot(df_train['site1'], color="b")</p>
        <p class="px-4">plt.plot(df_train['site2'], color="g")</p>
        <p class="px-4">plt.plot(df_train['site3'], color="r")</p>
        <p class="px-4">plt.plot(df_train['site4'], color="c")</p>
        <p class="px-4">plt.plot(df_train['site5'], color="m")</p>
        <p class="px-4">plt.plot(df_train['site6'], color="y")</p>
        <p class="px-4">plt.plot(df_train['site7'], color="silver")</p>
        <p class="px-4">plt.plot(df_train['site8'], color="wheat")</p>
        <p class="px-4">plt.plot(df_train['site9'], color="lime")</p>
        <p class="px-4">plt.plot(df_train['site10'], color="violet")</p>
        <p class="px-4">plt.show()</p>
        <p>.</p>
    <p class="text-start fs-2 fw-bold text-success">1.4 Конструирование признаков (Feature Engineering)</p>
      <p class="fw-bolder ">Создаем метод new_time, для более удобной и компактного преобразования времени во float.</p>
      <p>def new_time(database,table_name):</p>
      <p class="fw-bolder px-2">Преобразуем время в значение float</p>
        <p class="px-2">dfsizer = 0</p>
        <p class="px-2">try:</p>
          <p class="px-3">while (dfsizer = database.size):</p>
            <p class="px-5">t = time.strptime(database[table_name][dfsizer], '%Y-%m-%d %H:%M:%S')</p>
            <p class="px-5">new_time = time.strftime('%Y%m%d %H%M%S', t)</p>
            <p class="px-5">database[table_name] = database[table_name].replace(database[table_name][dfsizer], new_time)</p>
            <p class="px-5">timelists.append(new_time)</p>
            <p class="px-5">dfsizer += 1</p>
            <p>.</p>

        <p class="px-2">except Exception as ex:</p>
          <p class="px-3">pass</p>
        <p class="px-2">return ''.join(timelists)</p> 
        <p>.</p>
        <p>def ses_time(database,table_name):</p>               
          <p class="px-2">try:</p>   
            <p class="px-3">for inds in range(database.size):</p>     
            <p class="px-4">sestimelist.append(</p>
            <p class="px-5">str(database['session_id'][inds]) + "-" + str(database[table_name][inds]))</p>
            <p>.</p>
          <p class="px-2">except Exception as ex:</p>
            <p class="px-3">pass</p> 
          <p class="px-2">return ''.join(sestimelist):</p>  
          <p>.</p>    
        <p>def target():</p>  
          <p class="px-2">for inds in range(df_train.size):</p>
            <p class="px-3">if(df_train['target'][inds] == 1):</p>
              <p class="px-4">print("Сесия: {}".format(df_train['session_id']) + " Сайты: {}".format(df_train['site1'])+" / {}".format(df_train['site2'])+" / {}".format(df_train['site3'])+" / {}".format(df_train['site4'])+" / {}".format(df_train['site5'])+" / {}".format(df_train['site6'])+" / {}".format(df_train['site7'])+" / {}".format(df_train['site8'])+" / {}".format(df_train['site9'])+" / {}".format(df_train['site10']))</p>       
              <p>.</p>         
        <p>def linrg():</p>
          <p class="px-2">Загружаем данные только с двумя признаками</p>
          <p class="px-2">length = 10</p>
          <p class="px-2">x = np.arange(length, dtype=float).reshape((length, 1))</p>
          <p class="px-2">y = x + (np.random.rand(length) * 10).reshape((length, 1))</p>
          <p class="px-2">.</p>
          <p class="px-2">x = x.reshape(length, 1)</p>
          <p class="px-2">y = y.reshape(length, 1)</p>
          <p class="px-2">regr = linear_model.LinearRegression()</p>
          <p class="px-2">y = y.reshape(length, 1)</p>
          <p class="px-2">regr.fit(x, y)</p>
          <p class="px-2">.</p>
          <p class="px-2">plt.scatter(x, y, color='black')</p>
          <p class="px-2">plt.plot(x, regr.predict(x), color='blue', linewidth=3)</p>
          <p class="px-2">plt.xticks(())</p>
          <p class="px-2">plt.yticks(())</p>
          <p class="px-2">plt.show()</p>

          <p class="text-start fs-2 fw-bold text-success">Консольный бот для работы с приложением</p>
          <p>if __name__ == '__main__':</p>
          <p class="px-2">print(Fore.GREEN +"------------------Запуск консольной панели для выполнения результатов------------------\n")</p>
          <p class="px-2">print(Fore.GREEN +"\nСписок возможностей:\n"</p>
          <p class="px-4">+ "\n1 - Удалить строки имеющие пустые значения."</p>
          <p class="px-4">+ "\n2 - Выполнить сортировку по файлу."</p>
          <p class="px-4">+ "\n3 - Выполнить сортировку таблицы по столбцу 'session_id'"</p>
          <p class="px-4">+ "\n4 - Отражение матрицы  (мешка сайтов)."</p>
          <p class="px-4">+ "\n5 - Вывести имеются ли дубликаты в сессий сайта."</p>
          <p class="px-4">+ "\n6 - Нарисовать график посещений сайта."</p>
          <p class="px-4">+ "\n7 - Изминение вида даты в число ГГГГММ (Из всей таблицы)"</p>
          <p class="px-4">+ "\n8 - Признак Сессия-Дата входа (Из всей таблицы)"</p>
          <p class="px-4">+ "\n9 - Отражение матрицы (Рандомные значения) (мешка сайтов)."</p>
          <p class="px-4">+ "\n10 - Сайты которые посещал злоумышленник."</p>
          <p class="px-4">+ "\n11 - Выполнение линейной регрессии."</p>
          <p class="px-4">)</p>
          <p class="px-2">joined = input("Введите выбранный пункт:")</p>
          <p class="px-2">if(joined == "1"):</p>
          <p class="px-4">dropnulls()</p>
          <p class="px-2">if(joined == "2"):</p>
          <p class="px-4">sortdb()</p>
          <p class="px-2">if(joined == "3"):</p>
          <p class="px-4">sortsess()</p>
          <p class="px-2">if(joined == "4"):</p>
          <p class="px-4">dbcheck = input(Fore.CYAN +"Выберете Базу\n"</p>
          <p class="px-5">+"\n1 - test_ses"</p>
          <p class="px-5">+"\n2 - train_ses"</p>
          <p class="px-5">+ " :"</p>
          <p class="px-5">)</p>
          <p class="px-4">if(dbcheck == "1"):</p>
          <p class="px-5">print(visitsits_dftest)</p>
          <p class="px-5">newmatrix1lists.clear()</p>
          <p class="px-4">if(dbcheck == "2"):</p>
          <p class="px-5">print(visitsits_dftrain)</p>
          <p class="px-5">newmatrix2lists.clear()</p>
          <p class="px-2">if(joined == "5"):</p>
          <p class="px-4">sutes_session_dub()</p>
          <p class="px-2">if(joined == "6"):</p>
          <p class="px-4">dbcheckplot = input(Fore.CYAN +"Выберете Базу\n"</p>
          <p class="px-5">+"\n1 - test_ses"</p>
          <p class="px-5">+"\n2 - train_ses"</p>
          <p class="px-5">+ " :"</p>
          <p class="px-5">)</p>
          <p class="px-4">if(dbcheckplot == "1"):</p>
          <p class="px-5">sist_check_df_test()</p>
          <p class="px-4">if(dbcheckplot == "2"):</p>
          <p class="px-5">sist_check_df_train()</p>
          <p class="px-2">if(joined == "7"):</p>
          <p class="px-4">dbchecks = input(Fore.CYAN +"Выберете Базу\n"</p>
          <p class="px-5">+"\n1 - test_ses"</p>
          <p class="px-5">+"\n2 - train_ses"</p>
          <p class="px-5">+ " :"</p>
          <p class="px-5">)</p>
          <p class="px-4">if(dbchecks == "1"):</p>
          <p class="px-5">timesr = input("Введите название таблицы time's (Допустимые значения 'time1-time10')")</p>
          <p class="px-5">print(Fore.MAGENTA+new_time(df_test, timesr))</p>
          <p class="px-4">if(dbchecks == "2"):</p>
          <p class="px-5">timesr = input("Введите название таблицы time's (Допустимые значения 'time1-time10')")</p>
          <p class="px-5">print(Fore.MAGENTA+new_time(df_train, timesr))</p>
          <p class="px-2">if(joined == "8"):</p>
          <p class="px-4">dbchecks = input(Fore.CYAN +"Выберете Базу\n"</p>
          <p class="px-5">+"\n1 - test_ses"</p>
          <p class="px-5">+"\n2 - train_ses"</p>
          <p class="px-5">+ " :"</p>
          <p class="px-5">)</p>
          <p class="px-4">if(dbchecks == "1"):</p>
          <p class="px-5">timesr = input("Введите название таблицы time's (Допустимые значения 'time1-time10')")</p>
          <p class="px-5">print(Fore.MAGENTA+ses_time(df_test, timesr))</p>
          <p class="px-4">if(dbchecks == "2"):</p>
          <p class="px-5">timesr = input("Введите название таблицы time's (Допустимые значения 'time1-time10')")</p>
          <p class="px-5">print(Fore.MAGENTA+ses_time(df_train, timesr))</p>
          <p class="px-2">if(joined == "9"):</p>
          <p class="px-4">visitsits_dftrain_rand()</p>
          <p class="px-2">if(joined == "10"):</p>
          <p class="px-4">target()</p>
          <p class="px-2">if(joined == "11"):</p>
          <p class="px-4">linrg()</p>
          <p class="px-2">if((joined != "1") and (joined != "2") and (joined != "3") and (joined != "4") and (joined != "5") and (joined != "6") and (joined != "7") and (joined != "8") and (joined != "9") and (joined != "10") and (joined != "11")):</p>
          <p class="px-4">print(Fore.RED+"Вы ввели неподдерживаемый символ."+Fore.BLUE+"\nПерезапустите программу.")</p>

    </div>
  
</body>
</html>
